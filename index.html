<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <title>Natural and Semi-Urban Dataset</title>

  <link rel="stylesheet" href="stylesheets/styles.css">
  <link rel="stylesheet" href="stylesheets/pygment_trac.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <meta name="viewport" content="width=device-width">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<body>
  <div class="wrapper">
    <header>
      <h1>Natural and Semi-Urban Dataset</h1>
      <p>A dataset designed to capture short-term environmental changes across both natural and semi-urban environments,
        with specific aim of analyzing how such dynamics impact localization and re-localization performance.</p>
      <p class="view">
        <a href="https://github.com/RaoufDannaoui1/Natural_and_Semi-Urban_Dataset">
          View the Project on GitHub
          <small>RaoufDannaoui1/Natural_and_Semi-Urban_Dataset</small>
        </a>
      </p>
    </header>
    <section>
      <p><img src="images/header.png" alt="Dataset overview"></p>

      <p><strong>Weekly Multi-Temporal Dataset for Short-Term Localization and Environmental Change Analysis,</strong>
        designed to study the impact of real-world environmental changes on localization.</p>

      <h2>Overview</h2>
      <p>
        The dataset is a short-term, high-resolution, multi-modal dataset focused on understanding how real-world
        changes, such as vegetation growth, trimming, and object displacement, affect 3D LiDAR-based localization in
        dynamic outdoor environments.
      </p>
      <p>
        The data was collected weekly from February to April 2025, across two contrasting outdoor scenarios:
      <ul>
        <li>
          <strong>Natural Environment:</strong> INRAE Forest, Clermont-Ferrand
          <img src="images/natural_traj_cloud.png" alt="Natural environment "></img>
        </li>
        <li>
          <strong>Semi-Urban Environment:</strong> Around Université Clermont Auvergne
          <img src="images/semiurban_traj_cloud.png" alt="Semi-Urban environment">
        </li>
      </ul>

      </p>
      <p>
        This dataset provides a unique opportunity to analyze and benchmark localization robustness over short time
        intervals, making it ideal for applications in re-localization, change detection, SLAM, and dynamic mapping.
      </p>

      <h2>Data Content Description</h2>
      <p>
        <ul>
          <li><strong>Colorized & classified point clouds</strong>
            <ul>
              <li>Provided per semantic class (ground, vegetation, vehicles, etc.)</li>
              <li>~100 million points for a Semi-Urban map and ~150 million points for a Natural map</li>
              <li>Average size: ~4 GB for a Semi-Urban map and ~5.5 GB for a Natural map (LAS format files)</li>
            </ul>
          </li>
          <li><strong>Panoramic images</strong>
            <ul>
              <li>360° images captured every 3 meters along each track</li>
              <li>Resolution: 7040x3520 pixels</li>
              <li>Average size: ~2-3 MB per image (JPEG)</li>
              <li>Includes GNSS-tagged camera trajectory</li>
            </ul>
          </li>
          <li><strong>GNSS/IMU trajectories</strong>
            <ul>
              <li>Provides full pose: position (x, y, z) and orientation (quaternion: qw, qx, qy, qz)</li>
            </ul>
          </li>
        </ul>

        <img src="images/pc_overview.png" alt="Leica Pegasus TRK100 mounted on a Zoe electric vehicle">

      </p>

      <h2>Acquisition Platform</h2>
      <p>
        All data is recorded using a Leica Pegasus TRK100 mounted on a Zoe electric vehicle, the Leica is equipped with:
      <ul>
        <li>Two 16-beam LiDARs</li>
        <li>360° panoramic camera</li>
        <li>GNSS and IMU for centimeter-level pose accuracy</li>
      </ul>
      <img src="images/zoe_leica.jpeg" alt="Leica Pegasus TRK100 mounted on a Zoe electric vehicle">
      </p>

      <h2>Folder Structure</h2>
      <pre><code>weekXX_hhmm-DD-MM-YYYY/
      ├── assets/
      │   └── track_trajectories/
      │
      ├── images_360/
      │   ├── SemiUrban_track1-2/
      │   └── Natural_track3-4/
      │
      └── point_clouds/
          ├── SemiUrban_track1-2/
          └── Natural_track3-4/</code></pre>

      <style>
        table {
          width: 100%;
          margin: 20px auto;
          border-collapse: collapse;
        }

        th,
        td {
          padding: 10px;
          border: 1px solid #ccc;
          text-align: left;
        }

        tr td:first-child,
        tr td:nth-child(3) {
          text-align: center;
        }

        .filters-container {
          display: flex;
          flex-direction: column;
        }

        select {
          padding: 5px;
          margin-bottom: 10px;
          border: 1px solid #ccc;
          border-radius: 6px;
          background-color: #8bd8ff;
          transition: border-color 0.3s ease;
        }

        .commandButton {
          padding: 5px;
          margin-top: 25px;
          border: 1px solid #ccc;
          border-radius: 6px;
          background-color: #2ea44f;
          color: #fff;
          font-weight: bold;
        }

        .commandButton:hover {
          background-color: #187a34;
          transition: 0.3s;
          cursor: pointer;
        }

        .spinner {
          width: 40px;
          height: 40px;
          margin: auto;
          border: 4px solid #ddd;
          border-top: 4px solid #39c;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          0% {
            transform: rotate(0deg);
          }

          100% {
            transform: rotate(360deg);
          }
        }

        #envFilterContainer {
          display: none;
          /* Hidden by default */
        }

        .note {
          background-color: #f8b97d;
          border-left: 6px solid #ff7b00;
          padding: 10px;
          margin: 20px 0;
          border-radius: 5px;
        }

        .command-modal {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 1000;
        }

        .command-modal-content {
          background: white;
          padding: 30px;
          border-radius: 10px;
          width: 600px;
          max-width: 90%;
          max-height: 80vh;
          overflow-y: auto;
        }

        .command-code {
          background: #f5f5f5;
          padding: 15px;
          border-radius: 5px;
          border: 1px solid #ddd;
          font-family: monospace;
          white-space: pre-wrap;
          word-break: break-all;
          margin: 15px 0;
        }

        .copy-button {
          background: #39c;
          color: white;
          border: none;
          padding: 8px 15px;
          border-radius: 5px;
          cursor: pointer;
          margin-top: 10px;
        }

        .copy-button:hover {
          background: #2a8bb8;
        }

        .close-button {
          background: #6c757d;
          color: white;
          border: none;
          padding: 8px 15px;
          border-radius: 5px;
          cursor: pointer;
          margin-top: 10px;
          margin-left: 10px;
        }

        .close-button:hover {
          background: #545b62;
        }
      </style>

      <h2>Browse Dataset Files</h2>
      <div id="loadingMessage" style="text-align: center; margin: 40px;">
        <div class="spinner"></div>
        <p>Loading dataset files...</p>
      </div>
      <div id="mainContent" style="display: none;">
        <div class="filters-container">
          <label for="weekFilter">Choose Week:</label>
          <select id="weekFilter">
            <option value="all">All Weeks</option>
          </select>
  
          <label for="typeFilter">Data Type:</label>
          <select id="typeFilter">
            <option value="all">All Types</option>
            <option value="assets" selected>Assets</option>
            <option value="images_360">Images 360</option>
            <option value="point_clouds">Point Clouds</option>
          </select>

          <div id="envFilterContainer" style="display: none;">
            <label for="envFilter">Environment:</label>
            <select id="envFilter">
              <option value="all">All Environments</option>
              <option value="Natural">Natural</option>
              <option value="SemiUrban">Semi-Urban</option>
            </select>
          </div>

          <button class="commandButton" onclick="generateDownloadCommand()">Generate Download Command</button>
        </div>

        <table id="fileTable">
          <thead>
            <tr>
              <th style="text-align: center;">Download</th>
              <th>File Path</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <script>
        const repoId = "ardannaoui/Natural_and_SemiUrban_Dataset";
        const baseApiUrl = `https://huggingface.co/api/datasets/${repoId}/tree/main`;

        let allFiles = [];
        // Predefined weeks available immediately
        const predefinedWeeks = ['week00_1400-10-02-2025', 'week01_0915-17-02-2025', 
        'week02_0920-24-02-2025', 'week03_0900-03-03-2025', 'week04_0910-10-03-2025', 'week05_0910-17-03-2025', 
        'week06_0900-24-03-2025', 'week07_0900-31-03-2025', 'week08_0900-07-04-2025', 'week09_0900-14-04-2025',];

        // Load weeks immediately on page load
        function loadInitialWeeks() {
          const weekFilter = document.getElementById("weekFilter");
          
          // Clear existing options except "All Weeks"
          while (weekFilter.children.length > 1) {
            weekFilter.removeChild(weekFilter.lastChild);
          }

          // Add predefined weeks
          predefinedWeeks.forEach(week => {
            const option = document.createElement("option");
            option.value = week;
            option.textContent = week;
            weekFilter.appendChild(option);
          });

          // Set default selection
          if (predefinedWeeks.length > 0) {
            weekFilter.value = predefinedWeeks[0];
          }
        }

        async function fetchTree(path = "") {
          const url = `${baseApiUrl}/${path}`.replace(/\/+$/, "");
          try {
            const res = await fetch(url);

            // Check if we hit rate limit
            if (res.status === 429) {
              throw new Error("Rate limit exceeded. Please try again later.");
            }

            if (!res.ok) {
              throw new Error(`HTTP error! status: ${res.status}`);
            }

            const items = await res.json();

            // Check if items is iterable
            if (!items || typeof items[Symbol.iterator] !== 'function') {
              throw new Error("Invalid response format from server");
            }

            for (const item of items) {
              if (item.type === "file") {
                allFiles.push(item.path);
              } else if (item.type === "directory") {
                await fetchTree(item.path);
              }
            }
          } catch (err) {
            console.error("Error fetching tree:", err);
            throw err;
          }
        }

        async function loadAndRender() {
          // Show weeks immediately
          loadInitialWeeks();
          renderTable();

          // Hide loading and show content immediately
          document.getElementById("loadingMessage").style.display = "none";
          document.getElementById("mainContent").style.display = "block";

          // Try to fetch actual files in background
          try {
            await fetchTree();
            // If successful, update filters with actual data
            populateFiltersWithActualData();
            renderTable();
          } catch (err) {
            console.error("Background loading failed:", err);
            // Keep using predefined weeks, no need to show error to user
          }
        }

        function populateFiltersWithActualData() {
          const weekFilter = document.getElementById("weekFilter");
          const weeks = new Set();

          // Populate from actual files
          allFiles.forEach(path => {
            const parts = path.split('/');
            if (parts[0].startsWith("week")) {
              weeks.add(parts[0]);
            }
          });

          if (weeks.size > 0) {
            // Clear existing options except "All Weeks"
            while (weekFilter.children.length > 1) {
              weekFilter.removeChild(weekFilter.lastChild);
            }

            // Add actual weeks from API
            [...weeks].sort().forEach(week => {
              const option = document.createElement("option");
              option.value = week;
              option.textContent = week;
              weekFilter.appendChild(option);
            });

            // Keep the current selection if it exists in new data, otherwise use first available
            const currentWeek = weekFilter.value;
            if (![...weeks].includes(currentWeek) && weeks.size > 0) {
              weekFilter.value = [...weeks][0];
            }
          }
        }

        function renderTable() {
          const weekValue = document.getElementById("weekFilter").value;
          const typeValue = document.getElementById("typeFilter").value;
          const envValue = document.getElementById("envFilter").value;
          const tbody = document.querySelector("#fileTable tbody");
          tbody.innerHTML = "";

          // If no files loaded from API, show informative message
          if (allFiles.length === 0) {
            const row = document.createElement("tr");
            const cell = document.createElement("td");
            cell.colSpan = 2;
            cell.style.textAlign = "center";
            cell.style.padding = "40px";
            cell.innerHTML = `
              <i class="fas fa-info-circle" style="font-size: 24px; color: #39c; margin-bottom: 10px;"></i>
              <p>File list is being loaded in the background.</p>
              <p>You can use the "Generate Download Command" button to get CLI commands for downloading.</p>
              <p style="font-size: 0.9em; margin-top: 10px; color: #666;">
                Available weeks: ${predefinedWeeks.join(', ')}
              </p>
            `;
            row.appendChild(cell);
            tbody.appendChild(row);
            return;
          }

          const filtered = allFiles.filter(path => {
            if (weekValue !== "all" && !path.startsWith(weekValue)) return false;

            if (typeValue !== "all") {
              if (typeValue === "images_360" && !path.includes("/images_360/")) return false;
              if (typeValue === "point_clouds" && !path.includes("/point_clouds/")) return false;
              if (typeValue === "assets" && !path.includes("/assets/")) return false;
            }

            if (envValue !== "all" &&
              (typeValue === "point_clouds" || typeValue === "images_360")) {
              const envPattern = envValue === "Natural" ? "Natural_track" : "SemiUrban_track";
              if (!path.includes(envPattern)) return false;
            }

            return true;
          });

          if (filtered.length === 0) {
            const row = document.createElement("tr");
            const cell = document.createElement("td");
            cell.colSpan = 2;
            cell.style.textAlign = "center";
            cell.style.padding = "20px";
            cell.textContent = "No files match the current filters.";
            row.appendChild(cell);
            tbody.appendChild(row);
            return;
          }

          filtered.forEach(path => {
            const row = document.createElement("tr");

            const downloadCell = document.createElement("td");
            const downloadLink = document.createElement("a");
            downloadLink.href = `https://huggingface.co/datasets/${repoId}/resolve/main/${path}?download=true`;
            downloadLink.target = "_blank";
            downloadLink.setAttribute("download", "");
            downloadLink.title = "Download file";
            downloadLink.innerHTML = `<i class="fas fa-download" style="color:#39c;"></i>`;
            downloadCell.appendChild(downloadLink);

            const nameCell = document.createElement("td");
            nameCell.textContent = path;

            row.appendChild(downloadCell);
            row.appendChild(nameCell);
            tbody.appendChild(row);
          });
        }

        function updateFilterVisibility() {
          const typeValue = document.getElementById("typeFilter").value;
          const envFilterContainer = document.getElementById("envFilterContainer");

          if (typeValue === "point_clouds" || typeValue === "images_360") {
            envFilterContainer.style.display = "block";
          } else {
            envFilterContainer.style.display = "none";
          }
        }

        function generateDownloadCommand() {
          const weekValue = document.getElementById("weekFilter").value;
          const typeValue = document.getElementById("typeFilter").value;
          const envValue = document.getElementById("envFilter").value;

          let includePattern = "";

          if (weekValue !== "all") {
            includePattern += `${weekValue}*/`;
          } else {
            includePattern += "*/";
          }

          if (typeValue !== "all") {
            includePattern += `${typeValue}/`;
          } else {
            includePattern += "*/";
          }

          if (envValue !== "all" && (typeValue === "point_clouds" || typeValue === "images_360")) {
            includePattern += `${envValue}_track*/**`;
          } else if (typeValue !== "all") {
            includePattern += "**";
          } else {
            includePattern += "*/**";
          }

          const command = `huggingface-cli download ardannaoui/Natural_and_SemiUrban_Dataset \\
  --repo-type dataset \\
  --include "${includePattern}" \\
  --local-dir .`;

          const modal = document.createElement("div");
          modal.className = "command-modal";
          modal.innerHTML = `
            <div class="command-modal-content">
              <h3>Download Command</h3>
              <p>Use this command to download the selected data using the Hugging Face CLI:</p>
              <div class="command-code">${command}</div>
              <button class="copy-button" onclick="copyCommandToClipboard()">Copy Command</button>
              <button class="close-button" onclick="this.closest('.command-modal').remove()">Close</button>
              <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                <strong>Note:</strong> Make sure you have the Hugging Face CLI installed:<br>
                <code>pip install huggingface_hub</code>
              </p>
            </div>
          `;

          document.body.appendChild(modal);
          modal._command = command;
        }

        function copyCommandToClipboard() {
          const modal = document.querySelector('.command-modal');
          const command = modal._command;

          navigator.clipboard.writeText(command).then(() => {
            const copyButton = document.querySelector('.copy-button');
            const originalText = copyButton.textContent;
            copyButton.textContent = 'Copied!';
            copyButton.style.background = '#28a745';

            setTimeout(() => {
              copyButton.textContent = originalText;
              copyButton.style.background = '#39c';
            }, 2000);
          }).catch(err => {
            console.error('Failed to copy command: ', err);
            alert('Failed to copy command to clipboard');
          });
        }

        document.getElementById("weekFilter").addEventListener("change", renderTable);
        document.getElementById("typeFilter").addEventListener("change", function () {
          updateFilterVisibility();
          renderTable();
        });
        document.getElementById("envFilter").addEventListener("change", renderTable);

        loadAndRender();
      </script>

      <div class="note">
        <div><strong>Note!</strong></div>
        Due to a technical issue, data corresponding to weeks 11-13 will not be processed and will not be included in this dataset. Thank you for understanding.
      </div>

      <h2>Citation</h2>
      <p>If you use this dataset in your research, please cite our paper. </p>
      <pre><code>@inproceedings{ardannaoui_2025_icp_analysis,
  title={When and Where Localization Fails: An Analysis of the Iterative Closest Point in Evolving Environments},
  author={Dannaoui, Abdelraouf and Laconte, Johann and Debain, Christophe and Pomerleau, Fran{\c{c}}ois and Checchin, Paul},
  booktitle={2025 European Conference on Mobile Robots (ECMR)},
  year={2025},
  organization={IEEE},
  note={Accepted for publication}
}</code></pre>

      <h2>License</h2>
      <p>Data will be released under a permissive academic license (TBD).</p>

      <h2>Contact</h2>
      <p>
        For questions or collaboration inquiries, please contact: <br><br>
        Abdel-Raouf Dannaoui <br>
        Ph.D. Candidate in Robotics -- INRAE <br>
        <a href="mailto:dannaoui.abdelraouf@gmail.com">dannaoui.abdelraouf@gmail.com</a>
      </p>
    </section>

    <footer>
      <p>This project is maintained by
        <a href="https://github.com/RaoufDannaoui1" target="_blank">Abdel-Raouf Dannaoui</a> - PhD Candidate in Computer Vision and Robotics
      </p>
      <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a></small></p>
    </footer>
  </div>
  <script src="javascripts/scale.fix.js"></script>
</body>

</html>